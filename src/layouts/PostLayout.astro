---
import Toc from "../components/Toc.astro";
import "../styles/global.css";

const { frontmatter, headings } = Astro.props;

const title = frontmatter?.title ?? "Untitled";
const author = frontmatter?.author ?? "Anonymous";
const date = frontmatter?.date ?? "";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title}</title>
    <link rel="icon" href={`${import.meta.env.BASE_URL}favicon.svg`} />
  </head>

  <body>
    <div class="container">
      <div class="topbar">
        <div><a href="/blog/">Blog Home</a></div>
        <div><a href="/">PRAISe Lab Home</a></div>

        <div class="topbar-actions">
          <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle theme">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M12 18a6 6 0 100-12 6 6 0 000 12z"
                stroke="currentColor"
                stroke-width="2"
              />
              <path
                d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
            <span id="themeLabel">Theme</span>
          </button>

          <button
            id="paperToggle"
            class="theme-toggle mode-toggle"
            type="button"
            aria-label="Toggle paper mode"
            title="Paper mode"
          >
            <span aria-hidden="true">⟡</span>
            <span id="paperLabel">Paper</span>
          </button>
        </div>
      </div>

      <div class="layout">
        <aside>
          <Toc headings={headings} />
        </aside>

        <main>
          <h1 class="post-title">{title}</h1>

          <div class="byline">
            <div>
              By <a href="#">{author}</a>
            </div>
            <div>{date}</div>
          </div>

          <slot />
        </main>
      </div>
    </div>

    <script is:inline>
      (() => {
        // ---- Theme (light/dark) ----
        const STORAGE_KEY = "theme"; // "light" | "dark"
        const root = document.documentElement;

        const btn = document.getElementById("themeToggle");
        const label = document.getElementById("themeLabel");
        const icon = document.getElementById("themeIcon"); // optional

        if (!btn) return;

        const apply = (mode) => {
          if (mode === "dark") root.setAttribute("data-theme", "dark");
          else root.removeAttribute("data-theme");

          // Button shows what you will switch TO
          const next = mode === "dark" ? "Light" : "Dark";
          if (label) label.textContent = next;
          if (icon) icon.textContent = mode === "dark" ? "☀" : "☾";

          btn.setAttribute(
            "aria-label",
            mode === "dark" ? "Switch to light mode" : "Switch to dark mode"
          );
        };

        // Default light unless user explicitly saved a preference
        const saved = localStorage.getItem(STORAGE_KEY);
        const initial = (saved === "light" || saved === "dark") ? saved : "light";
        apply(initial);

        btn.addEventListener("click", () => {
          const current = root.getAttribute("data-theme") === "dark" ? "dark" : "light";
          const next = current === "dark" ? "light" : "dark";
          localStorage.setItem(STORAGE_KEY, next);
          apply(next);
        });
      })();
    </script>

    <script is:inline>
      (() => {
        // ---- Paper mode (default/paper) ----
        const STORAGE_KEY = "mode"; // "default" | "paper"
        const root = document.documentElement;

        const btn = document.getElementById("paperToggle");
        const label = document.getElementById("paperLabel");
        if (!btn) return;

        const apply = (mode) => {
          if (mode === "paper") root.setAttribute("data-mode", "paper");
          else root.removeAttribute("data-mode");

          // Button shows what you will switch TO
          const next = mode === "paper" ? "Default" : "Paper";
          if (label) label.textContent = next;

          btn.setAttribute(
            "aria-label",
            mode === "paper" ? "Switch to default mode" : "Switch to paper mode"
          );
        };

        const saved = localStorage.getItem(STORAGE_KEY);
        const initial = saved === "paper" ? "paper" : "default";
        apply(initial);

        btn.addEventListener("click", () => {
          const current = root.getAttribute("data-mode") === "paper" ? "paper" : "default";
          const next = current === "paper" ? "default" : "paper";
          localStorage.setItem(STORAGE_KEY, next);
          apply(next);
        });
      })();
    </script>
  </body>
</html>
